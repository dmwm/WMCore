WMStats.namespace("Globals");WMStats.Globals=function($){var _dbVariants={wmstats:"tier1",tier0_wmstats:"tier0",analysis_wmstats:"analysis"};function getReqDetailPrefix(){if(_dbVariants[dbname]=="tier1"){return"https://cmsweb.cern.ch/reqmgr/view/details/"}else if(_dbVariants[dbname]=="analysis"){return"/an_reqmgr/view/details/"}else{return null}}function getWorkloadSummaryPrefix(){return"https://cmsweb.cern.ch/couchdb/"+getWorkloadSummaryDB()+"/_design/WorkloadSummary/_show/histogramByWorkflow/"}function getWorkloadSummaryDB(){if(_dbVariants[dbname]=="tier1"){return"workloadsummary"}else if(_dbVariants[dbname]=="analysis"){return"analysis_workloadsummary"}else if(_dbVariants[dbname]=="tier0"){return"t0_workloadsummary"}}return{REQ_DETAIL_URL_PREFIX:getReqDetailPrefix(),WORKLOAD_SUMMARY_URL_PREFIX:getWorkloadSummaryPrefix(),AJAX_LOADING_STATUS:{beforeSend:function(){$("#loading_page").addClass("front").show()},complete:function(){$("#loading_page").hide()}},COUCHDB_NAME:dbname,WORKLOAD_SUMMARY_COUCHDB_NAME:getWorkloadSummaryDB(),VARIANT:_dbVariants[dbname],COUCHAPP_DESIGN:"WMStats",WORKLOAD_SUMMARY_COUCHAPP_DESIGN:"WorkloadSummary",CONFIG:null,loadScript:function(url,success){$.ajax({async:false,url:url,dataType:"script",success:success})},importScripts:function(scripts){for(var i=0;i<scripts.length;i++){document.write('<script src="'+scripts[i]+'"></script>')}},Event:{}}}(jQuery);WMStats.namespace("CustomEvents");WMStats.CustomEvents.REQUESTS_LOADED="C_1";WMStats.CustomEvents.AGENTS_LOADED="C_2";WMStats.CustomEvents.REQUEST_SUMMARY_READY="C_3";WMStats.CustomEvents.CATEGORY_SUMMARY_READY="C_4";WMStats.CustomEvents.REQUEST_DETAIL_READY="C_5";WMStats.CustomEvents.CATEGORY_DETAIL_READY="C_6";WMStats.CustomEvents.JOB_SUMMARY_READY="C_7";WMStats.CustomEvents.JOB_DETAIL_READY="C_8";WMStats.CustomEvents.LOADING_DIV_START="C_9";WMStats.CustomEvents.LOADING_DIV_END="C_10";WMStats.CustomEvents.HISTORY_LOADED="C_11";WMStats.CustomEvents.AJAX_LOADING_START="C_12";WMStats.namespace("Utils");WMStats.Utils.cloneObj=function(sourceObj){if(typeof sourceObj==="object"){var newObj=sourceObj.constructor();for(var prop in sourceObj){newObj[prop]=WMStats.Utils.cloneObj(sourceObj[prop])}return newObj}else{return sourceObj}};WMStats.Utils.updateObj=function(baseObj,additionObj,createFlag,updateFunc){for(var field in additionObj){if(!baseObj[field]){if(createFlag===undefined||createFlag){baseObj[field]=additionObj[field]}}else{if(typeof baseObj[field]=="object"){WMStats.Utils.updateObj(baseObj[field],additionObj[field],updateFunc)}else{if(updateFunc instanceof Function){updateFunc(baseObj,additionObj,field)}else{baseObj[field]+=additionObj[field]}}}}};WMStats.Utils.getOrDefault=function(baseObj,objList,val){if(baseObj[objList[0]]){if(objList.length==1){return baseObj[objList[0]]}else{return WMStats.Utils.getOrDefault(baseObj[objList[0]],objList.slice(1),val)}}else{return val}};WMStats.Utils.get=function(baseObj,objStr,val){if(baseObj===undefined){return val}objList=objStr.split(".");return WMStats.Utils.getOrDefault(baseObj,objList,val)};WMStats.Utils.formatReqDetailUrl=function(request){return'<a href="'+WMStats.Globals.REQ_DETAIL_URL_PREFIX+encodeURIComponent(request)+'" target="requestDetailFrame">'+request+"</a>"};WMStats.Utils.formatWorkloadSummarylUrl=function(request,status){if(status=="completed"||status=="announced"||status=="closed-out"||status=="normal-archived"||status=="abort-archived"){return'<a href="'+WMStats.Globals.WORKLOAD_SUMMARY_URL_PREFIX+encodeURIComponent(request)+'" target="workloadSummaryFrame">'+status+"</a>"}else{return status}};WMStats.Utils.formatDate=function(timestamp){var date=new Date(timestamp*1e3);return date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes()};WMStats.Utils.foramtDuration=function(timestamp){if(timestamp==-1)return"N/A";var totalMin=Math.floor(timestamp/60);var hours=Math.floor(totalMin/60);var min=totalMin%60;return hours+" h "+min+" m"};WMStats.Utils.createInputFilter=function(selector){var a=$(selector).serializeArray(),filter={};$.each(a,function(i,obj){filter[obj.name]=obj.value});return filter};WMStats.Utils.formatDetailButton=function(name){return'<div class="detailButton" name="'+name+'"></div>'};WMStats.Utils.utcClock=function(){function appendZero(num){if(num<10){return"0"+num}return num}var day=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var now=new Date;var month=now.getUTCMonth()+1;var utcString=now.getUTCFullYear()+"/"+month+"/"+now.getUTCDate()+" ("+day[now.getUTCDay()]+") "+appendZero(now.getUTCHours()+1)+":"+appendZero(now.getUTCMinutes())+":"+appendZero(now.getUTCSeconds())+" UTC";return utcString};WMStats.namespace("CouchBase");WMStats.namespace("Couch");WMStats.namespace("WorkloadSummaryCouch");WMStats.CouchBase=function(dbName,designName){var _Design=designName;var _couchDB=$.couch.db(dbName);var _config;function _combineOption(options,callback,ajaxOptions){var options=options||{};options.success=callback;var ajaxOptions=ajaxOptions;if(ajaxOptions){for(var opt in ajaxOptions){options[opt]=ajaxOptions[opt]}}return options}function loadConfig(func){function callback(data){var config;if(!data.rows&&data.rows.length!=1){config=null}else{config=data.rows[0].doc}WMStats.Globals.CONFIG=config;func()}_couchDB.view(_Design+"/config",_combineOption({include_docs:true},callback))}function view(name,options,callback,ajaxOptions){var options=options||{};if(options.stale===undefined){options.stale="update_after"}return _couchDB.view(_Design+"/"+name,_combineOption(options,callback,ajaxOptions))}function allDocs(options,callback,ajaxOptions){return _couchDB.allDocs(_combineOption(options,callback,ajaxOptions))}return{loadConfig:loadConfig,view:view,allDocs:allDocs}};WMStats.Couch=WMStats.CouchBase(WMStats.Globals.COUCHDB_NAME,WMStats.Globals.COUCHAPP_DESIGN);WMStats.WorkloadSummaryCouch=WMStats.CouchBase(WMStats.Globals.WORKLOAD_SUMMARY_COUCHDB_NAME,WMStats.Globals.WORKLOAD_SUMMARY_COUCHAPP_DESIGN);